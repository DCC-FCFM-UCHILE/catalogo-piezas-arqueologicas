"use strict";(self.webpackChunkcatalogomuseo=self.webpackChunkcatalogomuseo||[]).push([[829],{2829:(e,t,a)=>{a.r(t),a.d(t,{default:()=>E});var i=a(5043),n=a(835),l=a(9252),o=a(6446),r=a(8903),s=a(1292),c=a(2314),d=a(1906),u=a(5865),p=a(4535),m=a(9008),h=a(8480),g=a(2768),j=a(7392),x=a(2954),f=a(3471),A=a(7358),b=a(579);const y=(0,p.Ay)(j.A)((e=>{let{theme:t}=e;return{position:"absolute",top:4,right:4,width:24,height:24,padding:0,backgroundColor:"rgba(255, 255, 255, 0.8)",borderRadius:"50%",color:"red","&:hover":{backgroundColor:"rgba(255, 255, 255, 1)"},"& .MuiSvgIcon-root":{fontSize:20}}})),v=e=>{let{label:t,name:a,images:n,onListChange:l,allowedImageTypes:c}=e;const{addAlert:u}=(0,A.i)(),p=(0,i.useMemo)((()=>n.map((e=>e instanceof File?URL.createObjectURL(e):e))),[n]),m=c.join(", ");return(0,b.jsxs)(r.Ay,{container:!0,rowGap:2,children:[(0,b.jsx)(s.A,{component:"legend",children:t}),(0,b.jsxs)(r.Ay,{container:!0,rowGap:2,children:[(0,b.jsx)(r.Ay,{item:!0,children:(0,b.jsxs)(d.A,{component:"label",variant:"outlined",startIcon:(0,b.jsx)(x.A,{}),children:["Cargar m\xe1s im\xe1genes (",m,")",(0,b.jsx)("input",{type:"file",multiple:!0,hidden:!0,onChange:e=>{const t=Array.from(e.target.files),i=t.map((e=>e.name.split(".").pop())),o=c;i.some((e=>!o.includes(e)))?u("Tipo de archivo no permitido"):l((e=>({...e,[a]:[...n,...t]})))}})]})}),(0,b.jsx)(r.Ay,{container:!0,spacing:2,children:p.map(((e,t)=>(0,b.jsx)(r.Ay,{item:!0,children:(0,b.jsxs)(o.A,{position:"relative",children:[(0,b.jsx)("img",{src:e,alt:t,width:"100",height:"100"}),(0,b.jsx)(y,{onClick:()=>(e=>{const t=n.filter(((t,a)=>a!==e));l((e=>({...e,[a]:t})))})(t),children:(0,b.jsx)(f.A,{})})]})},t)))})]})]})};var w=a(9194),S=a(4565),F=a(6759);const T=(0,p.Ay)(u.A)((e=>{let{theme:t}=e;return{marginTop:t.spacing(6),textAlign:"left"}})),C=(0,p.Ay)(r.Ay)((e=>{let{theme:t}=e;return{display:"flex",flexDirection:"column"}})),E=()=>{var e;const t=(0,n.Zp)(),a=(0,n.zy)(),{artifactId:u}=(0,n.g)(),{addAlert:p}=(0,A.i)(),{token:j}=(0,S.r)(),[x,f]=(0,i.useState)(!1),[y,E]=(0,i.useState)({object:"",texture:"",material:"",thumbnail:"",images:[],description:"",shape:{id:"",value:""},culture:{id:"",value:""},tags:[]}),[k,D]=(0,i.useState)(!0),[_,I]=(0,i.useState)(!1),R=!(null===(e=a.state)||void 0===e||!e.from),[z,q]=(0,i.useState)([]),[L,M]=(0,i.useState)([]),[O,G]=(0,i.useState)([]),[V,W]=(0,i.useState)(!1);(0,i.useEffect)((()=>{y.object||y.texture||y.material?W(!0):W(!1)}),[y.object,y.texture,y.material]),(0,i.useEffect)((()=>{fetch("".concat(g.y.DETAILED_ARTIFACT,"/").concat(u),{headers:{Authorization:"Bearer ".concat(j)}}).then((e=>{if(e.ok||404!==e.status)return e.json();f(!0)})).then((e=>{let{attributes:t,thumbnail:a,model:i,images:n}=e;E({thumbnail:a,images:n,...i,...t})}))}),[u,j]),(0,i.useEffect)((()=>{fetch(g.y.ALL_METADATA,{headers:{Authorization:"Bearer ".concat(j)}}).then((e=>{if(!e.ok)throw new Error(e.statusText);return e.json()})).then((e=>{let t=e.data,a=t.shapes,i=t.cultures,n=t.tags;q(a),M(i),G(n)})).catch((e=>{I(!0),p(e.message)})).finally((()=>D(!1)))}),[j]);const B=(e,t)=>{E({...y,[e]:t})},P=e=>"object"===typeof e&&null!==e?e.name:"string"===typeof e&&e.includes("/")?e.split("/").pop():e;return(0,b.jsx)(b.Fragment,{children:x?(0,b.jsx)(w.A,{}):(0,b.jsx)(l.A,{children:(0,b.jsx)(o.A,{component:"form",autoComplete:"off",onSubmit:async e=>{if(e.preventDefault(),V){if(!y.object||!y.texture||!y.material)return void p("Por favor, sube los archivos necesarios para el modelo 3D.")}else if(0===y.images.length)return void p("Por favor, sube al menos una imagen del objeto.");const a=new FormData;y.object instanceof File&&a.append("model[new_object]",y.object),y.texture instanceof File&&a.append("model[new_texture]",y.texture),y.material instanceof File&&a.append("model[new_material]",y.material),y.thumbnail instanceof File?a.append("new_thumbnail",y.thumbnail):"string"===typeof y.thumbnail&&a.append("thumbnail",y.thumbnail.split("/").pop()),y.images.forEach((e=>{e instanceof File?a.append("new_images",e):"string"===typeof e&&a.append("images",e.split("/").pop())})),a.append("description",y.description),a.append("id_shape",y.shape.id),a.append("id_culture",y.culture.id),y.tags.forEach((e=>a.append("id_tags",e.id))),await fetch("".concat(g.y.DETAILED_ARTIFACT,"/").concat(u,"/update"),{method:"POST",body:a,headers:{Authorization:"Bearer ".concat(j)}}).then((e=>{if(!e.ok)throw new Error(e.statusText);return e.json()})).then((()=>{p("\xa1Objeto editado con \xe9xito!"),t("/catalog/".concat(u))})).catch((e=>{p(e.message)}))},children:(0,b.jsxs)(r.Ay,{container:!0,rowGap:4,children:[(0,b.jsxs)(T,{variant:"h1",children:["Editar pieza ",u]}),(0,b.jsxs)(r.Ay,{container:!0,spacing:2,children:[(0,b.jsxs)(C,{item:!0,xs:6,rowGap:2,children:[(0,b.jsx)(m.A,{label:V?"Objeto *":"Objeto",name:"object",isRequired:V,setStateFn:E,initialFilename:P(y.object)}),(0,b.jsx)(m.A,{label:V?"Textura *":"Textura",name:"texture",isRequired:V,setStateFn:E,initialFilename:P(y.texture)}),(0,b.jsx)(m.A,{label:V?"Material *":"Material",name:"material",isRequired:V,setStateFn:E,initialFilename:P(y.material)}),(0,b.jsx)(m.A,{label:"Miniatura (opcional)",name:"thumbnail",setStateFn:E,initialFilename:P(y.thumbnail)}),(0,b.jsx)(v,{label:"Im\xe1genes (opcional)",name:"images",images:y.images,onListChange:E,allowedImageTypes:F.allowedFileTypes.images})]}),(0,b.jsxs)(C,{item:!0,xs:6,rowGap:1,children:[(0,b.jsx)(s.A,{component:"legend",children:"Descripci\xf3n *"}),(0,b.jsx)(c.A,{required:!0,id:"description",name:"description",placeholder:"Descripci\xf3n del objeto",multiline:!0,rows:4,fullWidth:!0,value:y.description,onChange:e=>B(e.target.name,e.target.value)}),(0,b.jsx)(s.A,{component:"legend",children:"Forma *"}),(0,b.jsx)(h.A,{id:"shape",name:"shape",value:y.shape,setValue:B,options:z,placeholder:"Seleccionar la forma del objeto",isRequired:!0,fullWidth:!0,filterSelectedOptions:!0,disabled:k||_}),(0,b.jsx)(s.A,{component:"legend",children:"Cultura *"}),(0,b.jsx)(h.A,{id:"culture",name:"culture",value:y.culture,setValue:B,options:L,placeholder:"Seleccionar la cultura del objeto",isRequired:!0,fullWidth:!0,filterSelectedOptions:!0,disabled:k||_}),(0,b.jsx)(s.A,{component:"legend",children:"Etiquetas (opcional)"}),(0,b.jsx)(h.A,{multiple:!0,limitTags:3,fullWidth:!0,id:"tags",name:"tags",value:y.tags,setValue:B,options:O,placeholder:"Seleccionar las etiquetas del objeto",filterSelectedOptions:!0,disabled:k||_})]})]}),(0,b.jsxs)(r.Ay,{container:!0,justifyContent:"flex-end",columnGap:2,children:[(0,b.jsx)(d.A,{variant:"text",color:"secondary",onClick:()=>{const e=R?a.state.from:"/catalog";t(e,{replace:R})},children:R?"Cancelar":"Volver al cat\xe1logo"}),(0,b.jsx)(d.A,{variant:"contained",color:"primary",type:"submit",children:"Actualizar"})]})]})})})})}},3471:(e,t,a)=>{var i=a(4994);t.A=void 0;var n=i(a(39)),l=a(579);t.A=(0,n.default)((0,l.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete")}}]);
//# sourceMappingURL=829.79982506.chunk.js.map